# Lys Compiler

Source code for the Lys compiler. 

# Using Docker to Create the transpiled circuit:

There is a docker image with all the required dependencies installed. You can run the transpiler
with a simple make command

```make transpiler transpiled_circuit_path (lys.py cmdargs) ```

circuit_path should be the directory where you would like the transpiled circuit to be written to

List of Command Arguments for the Transpiler:


| Paramter                | URL                                                              |
|------------------------ | --------------------------------------------------------------   |
| input                   | Absolute path to the input circuit file.                         |
| language                | Choose the language of the circuit file. [qasm, projectq]        |
| combine (optional)      | Choose whether to combine the non-T rotations with measurement. Default is True|
| recompile (optional)     | Choose whether to recompile the cpp source code. Default is False|
| epsilon (optional)      | Set the value of decomposition precision. Positive values only. Smaller values give higher precision. Default is 1e-10|

This should produce a txt output file result of the transpiled circuit within the provided ```transpiled_circuit_path```

Heres a simple command you can use to test out the transpiler. Make sure to replace {PWD} with the current directory path 

```make transpiler transpiled_circuit_path=$(pwd)/Trillium/data/output input=$(pwd)/Trillium/data/input/test_circuits/qasm_test_10_lines.qasm language=qasm recompile=False epsilon=1```

* Important Note: File paths should be the absolute path to the file to ensure proper volume mounting

# Getting started Local Development:

## Prerequisites:
Python 3.8 +

Cpp standard 11+

Boost-python3

CMAKE 3.1.3+

Make tools

Numpy 

## Setting up the environment:
For MacOS, we recommend you install/update the following prerequisites through Homebrew:

```brew install boost-python3```

```brew install cmake```

```brew install make```

In general, we recommend using a virtual environment for python packages. 

(Optional step) If you choose to use a virtual environment, navigate to where you want to keep your virtual environment and use ```python -m venv name_of_virtual_environment```

(Optional step) Activate the environment by ```source path_to_env/name_of_virtual_env/bin/activate```

Pip install this package by ```pip install -e .``` in the root directory of this repository


## Usage:
Before you run the package, first compile the C++ code. We provide two ways to do so. Instructions are in section **Compiling the source code** below.

Once you have generated the compiler object, run ```python lys.py``` in the parent folder **Trillium** to use the package. 

A help message will be displayed to show the typical use case and help messages for each parameter. 


# Development:

## Compiling the source code:
Navigate to folder Trillium/src/cpp_compiler

This folder includes all the main optimized C++ for the actual compiler. Uses Boost to connect to the python modules at **python_wrapper**.  

To build:

Option 1: ```make``` will use the Makefile in the directory and compile the source files, will create runLysCompiler.o and runLysCompiler.so

Option 2: If ```make``` fails (likely due to path issues on different machines), use the CMakeLists.txt file to build. Enter ```cmake .```. 

This will build in the current directory which contains the CMakeList file. This however will overwrite the original Makefile. 

Then enter ```make``` which will create runLysCompiler.so. Igonore any other CMake generated folders and files. 

## Testing the cpp code:
Navigate to folder Trillium/src/cpp_tests

This folder includes all the test files for C++. Use ```make tests``` to run the tests.

TODO: Please try to move these tests to **boost testing** framework.

## Interfacing with Python modules:
The python portion of the code is located at folder Trillium/src/python_wrapper

This folder includes all the Python wrapper functions. To import the compiler into any Python file, import **LysCompiler_cpp_interface.py** and use the **LysCompiler** object. The **LysCompiler** will use the runLysCompiler.so file that you generated by compiling the cpp files.

Please note: The source files inside this folder, other than **LysCompiler_cpp_interface.py**, are not maintained. The most up-to-date implementation is done in cpp, contained in Trillium/src/cpp_compiler




